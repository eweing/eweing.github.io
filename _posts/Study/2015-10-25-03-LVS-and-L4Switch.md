---
layout: post
title: LVS vs L4 Switch
description: "LVS와 L4 Switch 그리고 그 둘의 차이점에 대해 공부해 본다."
categories: Study
---

## 로드밸런싱 (Load Balancing)
특정 프로세스에게 과부하가 걸렸을 때 이를 분산해서 처리하는 방식.   
웹 서비스의 경우 해당 서비스로 인해 발생하는 트래픽이 많을 경우
여러 대의 서버가 해당 트래픽을 분산 처리 하는 것을 말한다.

### 목적
1. 처리량 증가
2. 응답시간 최소화
3. 리소스 사용 최적화
4. 특정 서버 자원에게 과부하가 걸리는 것을 피하기 위함

***

## 서버 로드밸런싱
한 쪽 서버에만 지나치게 요청이 들어오지 않도록 사용량을 분배하는 것.

### 알고리즘
1. __Hasing__   
새로운 연결(TCP/UDP)이 일어날 경우 각 클라이언트에 대한 hasing key를 가지고 경로를 설정한다.
hasing key는 클라이언트의 IP와 port, 혹은 IP 주소 만으로 결정된다.
메모리를 적게 사용하고 요구 절차가 간단하다.   
2. __Round-Robin__   
라운드 로빈 방식으로 처리.   
각 클라이언트는 동일하게 취급되며, 각 서버나 경로는 같은 처리량을 보유해야 한다.   
3. __Weighted Round-Robin__   
서로 다른 처리 능력을 가진 서버가 있을 경우 사용한다.   
가중치를 줘서 많이 처리할 수 있는 서버로 많은 트래픽을 할당한다.   
4. __Least Connection__   
연결 수가 가장 적은 서버로 네트워크를 연결한다.
동적인 분산 알고리즘으로 각 서버에 대한 현재 연결 수를 동적으로 카운트 할 수 있다.   
5. __Weighted Least Connection__   
서버의 처리 능력을 고려하여 가중치를 부여하면서 Least Connection을 적용.   
트래픽을 골고루 분산시킨다.   

### 서비스 방식
네트워크 상단에 L4 스위치 가상 서버가 존재하여
서버로 들어오는 패킷을 리얼 서버로 트래픽을 균일하게 부하 분산 시킨다.
만약 리얼서버 중 정상적으로 작동하지 않는 서버가 있다면,
이를 감지하여 정상적으로 작동하는 서버에게 트래픽을 부하 분산 시킨다.

### 장점
1. 고가의 서버로 확장하지 않고 저렴한 비용으로 다수의 서버를 증설하여 경제적을 비용절감 할 수 있다.
2. 대량의 트래픽으로 특정 서버에게 부하가 발생할 경우 L4 스위치가 이를 감지하여 합리적으로 부하 분산을 처리한다.
3. 1대의 서버 장애가 발생해도 서비스 중단 없이 다른 서버에게 트래픽을 분배하여 서비스 운영이 끊기지 않는다.

***

## L4 Switch
### 3줄 요약
IP 주소와 포트를 기반으로 로드밸런싱하는 고가의 하드웨어이다.   
웬만한 서비스에서는 이것만으로도 부하 분산을 처리할 수 있다.   
가격이 매우 비싸다.

### Switch란?
네트워크 통신 장비.   
들어온 패킷을 자신의 로컬 네트워크 상에 그대로 보내주는 역할만 수행하는 허브(Hub)에서 발전된 형태.   
자신에게 연결된 디바이스들의 IP와 MAC 주소를 테이블로 모두 가지고 있다.   
패킷이 들어오면  Mac address 목적지를 확인하여 해당 디바이스로 패킷을 전송하는 역할을 수행한다.   
단, 자신에게 없는 목적지 주소가 들어오면 모든 기계에 포워딩 함.


### L2 Switch
Layer2 Switch   
Datalink층에서 동작하는 스위치.   
가장 원초적인 형태의 스위치로써 패킷이 왔을 때 목적지를 보고 해당 목적지로 보내주는 역할만 수행한다.   
IP를 이해할 수 없어 IP주소가 필요한 외부로 보내줄 수 없다.


### L3 Switch
L2 Switch에서 한 단계 업그레이드 된 스위치.   
Layer2의 프로토콜인 IP 에서 스위칭을 수행한다. 따라서 IP를 이해할 수 있다.   
자신에게 들어온 패킷의 목적지가 외부에 존재하는 IP일 경우 그 패킷을 외부에 연결된 라우터로 보내줄 수 있다.   
즉, 라우팅 기능을 갖고 있기 때문에 라우터와 경계가 모호해졌다.


### L4 Switch
Layer4의 프로토콜인 TCP 에서 스위칭 수행.   
들어온 패킷의 헤더를 보고 FTP/HTTP/SMTP 등을 구별할 수 있으며 어떤 것을 우선해서 스위칭할 지 판단할 수 있다.   
즉 로드밸런싱이 가능해진다는 말.

상위 레벨에서 동작하는 스위치는 자신의 하위 레벨 스위치의 기능을 다 갖고 있다.   
따라서 하위 레벨 스위치 기능도 수행할 수 있다.


***


## LVS
__Linux Virtual Server__   
리눅스 가상 서버   
고가용성 서버를 구축하기 위해 리눅스 머신을 로드밸런스 하도록 도와주는 운영시스템

한 대의 서버로 증가하는 인터넷 사용자를 처리하기 힘들어지면서   
고가용성 서버[^1]를 구축 하기 위한 리눅스 머신 로드밸런싱을 도와주는 운영 시스템이다.

[^1]:


***

## LVS & L4
두 개 모두 로드밸런싱을 위해 사용된다.

* L4는 로드밸런싱 처리를 위한 알고리즘이 탑재 되어 있음. 변경하는 것이 까다로움.   
LVS는 사용자가 직접 세팅 가능.
* L4는 장비 가격이 매우 비쌈.   
LVS는 오픈 소스가 존재하여 상대적으로 저렴하게 운영 가능.
* L4는 하드웨어, LVS는 소프트웨어
